本文将会总结以下知识点：

* 浮点数概念
* 浮点数的表示
* 浮点数的二进制存储以及FEEE754
* 浮点数的十进制与二进制转换
* 浮点数的运算
* 解释`0.1 + 0.2 = 0.300000004`的问题

参考：

https://zhuanlan.zhihu.com/p/495556086?utm_id=0

https://baseconvert.com/ieee-754-floating-point

## 浮点数的概念

首先回忆一下数学上的一些相关概念

实数和虚数共同构成复数

实数分为有理数与无理数

有理数分为整数和分数（又称小数，只包含有限小数和无限循环小数）

无理数为无限不循环小数

整数包含正整数和负整数以及0

自然数为0和正整数

可以看到实数的构成是整数加小数。

在计算机当中使用定点数和浮点数来表示小数

假设使用一个32位大小的空间来存储小数

定点数：小数点的位置是固定的比如6.125这个数，32位的最高位用来表示符号位，剩余24位来表示整数部分，而剩余7位来表示小数部分。

整数部分可以表示的大小为2^23-1，小数部分可以表示的大小为2^6-1=64,仅仅能表示2位小数，定点数表示小数无论是精度还是范围都很小。

浮点数：小数点的位置是不固定的，采用类似科学计数法的形式来表示。

## 浮点数的表示

IEEE754规定了浮点数的存储方式：

单精度（共32位）浮点数的空间表示为：

符号位（1）+指数（8）+尾数（23）

双精度（共64位）浮点数的空间表示为：

符号位（1）+指数（11）+尾数（52）

IEEE754规定，在二进制表示时浮点数通过移动小数点位置，将小数点前的值固定位1。IEEE754称这种形式的浮点数为规范化浮点数。

比如十进制数0.825，二进制为0.11010011001100110011...根据IEEE754标准规范化表示为0.101001100110011...

对于指数部分，因为指数有正负。为了避免使用符号位，同时方便比较，排序，指数部分采用了exponent（有偏指数）。IEEE754规定，2^(n-1)-1的值是0，其中n表示指数部分的位数，小于这个值为负数，大于这个值为正数。对于单精度浮点类型2^(8-1)-1=127是0；双精度浮点数，2^(11-1)-1=1023是0。

### 精度

由上可知，尾数部分决定了浮点数表示的精度。由于IEEE754规范隐藏了最前面的1位，所以实际可用于表示数据的长度有n+1位。

对于单精度浮点数，IEEE754规定指数部分使用8位来表示，取值范围为0-255，又规定0与255有特殊作用，实际指数取值范围为1-254，所以指数的实际取值范围是-126-127。而对于尾数部分由于最高位1隐式存在所以实际的有效位数为24位。



## 二进制与十进制的转换

十进制转二进制整数部分采用`除2取余法,倒序排列`，小数部分采用`乘2取整法，正序排列`

所以对于一个12.625的小数，采用浮点数转换如下：

```
整数部分12采用除2取余法
12 % 2 = 0
6 % 2 = 0
3 % 2 = 1
1 % 2 = 1
所以整数部分的二进制表示为：1100

小数部分采用乘2取整法
0.625 * 2 = 1.250 -> 1
0.250 * 2 = 0.5   -> 0
0.5   * 2 = 1.0   -> 1
所以小数部分的二进制表示为：101

加起来：1100.101 移位后：1.100101 

根据IEEE754，指数部分由于左移了3位所以指数应为3+127=130（10000010），12.625的单精度浮点表示为：0 10000010 10010100000000000000000

二进制转换为十进制为：
0 10000010 10010100000000000000000 = (1 + 1*2^-1 + 0*2^-2 + 0*2^-3 + 1*2^-4 + 0*2^-5 + 1*2^-6 + 0...)*2^3
								   = 1.578125 * 8
								   = 12.625
```

## 浮点数的运算



## 0.1+0.2

```
0.1的二进制表示为：0 01111011 10011001100110011001101
0.2的二进制表示为：0 01111100 10011001100110011001101
可见0.1和0.2都无法精确地用浮点数表示出来，在将十进制浮点数转换为二进制时产生了精度损失。
将二进制转换回十进制：
0.1=>0.100000001490116119384765625
0.2=>0.20000000298023223876953125

0.1 + 0.2 = 0.300000004470348358154....
```

